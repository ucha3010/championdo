<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml" lang="es">
<head>
    <meta th:replace="static/cabeceraMeta :: meta">
    <link th:replace="static/cabeceraLink :: link">
    <script th:replace="static/cabeceraScript :: script"></script>
    <script th:replace="static/cabeceraScriptJquery :: script"></script>

    <title>Administradores</title>

    <script type="text/javascript">
		function validar(){
			var campo = ['username','correo'];
			restablecer();
			var validado = true;
			for(var i=0; i < campo.length; i++){
			    var nombreRol = document.getElementById(campo[i]);
				if(nombreRol.value==''){
					nombreRol.style.borderColor="red";
					validado = false;
				}
			}

			if(!validarNifNie(document.getElementById('username').value)){
				document.getElementById('usernameError').innerHTML = "Error en formato del NIF/NIE";
				validado = false;
			}

			if(!validarEmail(document.getElementById('correo').value)){
				document.getElementById('correoError').innerHTML = "Error en formato del correo electrónico";
				validado = false;
			}

			if(validado){
				return true;
			} else {
				return false;
			}
		}

		function restablecer(){
			var errorSpan = document.getElementsByName('errorSpan');
			for (var i = 0; i < errorSpan.length; i++) {
				errorSpan[i].innerHTML='';
			}
			var campos = document.getElementsByClassName("form-control");
			for (var i = 0; i < campos.length; i++) {
				campos[i].style.borderColor="#ced4da";
			}
		}

		function confirmDeleteAdmin(username,id){
			if(confirm("¿Seguro que desea eliminar el administrador?")){
				var relativeUrl = "adminGimnasio/deleteAdminGym/" + username;
				var domain = getDomain(location.href);
				location.href = domain + relativeUrl;
				return true;
			}
			return false;
		}

    </script>

</head>
<body>
    <div th:replace="static/barraUsuario :: div"></div>
    <div th:replace="static/barraNav :: nav"></div>

    <div class="container">
        <section class="margenArribaAbajo3Porc text-center">
            <div th:if="${addAdmin != null}" class="alert alert-success" role="alert"><span th:text="${addAdmin}"></span></div>
            <div th:if="${addAdminKO != null}" class="alert alert-danger" role="alert"><span th:text="${addAdminKO}"></span></div>
            <div th:if="${deleteAdmin != null}" class="alert alert-success" role="alert"><span th:text="${deleteAdmin}"></span></div>
        </section>

        <section>
            <div class="row align-items-center justify-content-end">
                <div class="col-3 col-md-2">
                    <a class="btn btn-info" href="#" th:href="@{/adminGimnasio/}">Volver</a>
                </div>
            </div>
            <div class="row mb-3 text-center">
                <div class="col-12 colorGreen">
                    <h1>Administradores <span th:text="${gimnasio.nombreGimnasio}"></span></h1>
                </div>
            </div>
        </section>

        <section sec:authorize="hasRole('ROLE_ADMIN')">

            <form action="#" th:action="@{/adminGimnasio/addAdminGym}" class="margenArribaAbajo3Porc" th:object="${userModel}" method="post" onsubmit="return validar()">

                <div class="row mb-1 text-center">
                    <div class="col-12">
                        <h2>Agregar nuevo administrador</h2>
                    </div>
                </div>
                <div class="row mt-2 mb-1">
                    <div class="col-3 col-md-2">
                        <label for="username">DNI*</label>
                    </div>
                    <div class="col-9 col-md-3">
                        <input type="text" th:field="*{username}" id="username" class="form-control" placeholder="DNI" />
                    </div>
                    <div class="col-md-7">
                    </div>
                </div>

                <div class="row mb-1">
                    <div class="col-12">
                        <span id="usernameError" name="errorSpan" class="colorRed"></span>
                    </div>
                </div>

                <div class="row mb-1">
                    <div class="col-3 col-md-2">
                        <label for="correo">Correo electrónico*</label>
                    </div>
                    <div class="col-9 col-md-3">
                        <input type="text" th:field="*{correo}" id="correo" class="form-control" placeholder="Correo electrónico" />
                    </div>
                    <div class="col-md-7">
                    </div>
                </div>

                <div class="row mb-1">
                    <div class="col-12">
                        <span id="correoError" name="errorSpan" class="colorRed"></span>
                    </div>
                </div>

                <div class="row">
                    <div class="col-3">
                    </div>
                    <div class="col-9">
                        <button class="btn btn-success" id="continueButton" type="submit">Continuar</button>
                    </div>
                </div>
            </form>

            <table class="table table-striped table-hover">
                <thead>
                <tr>
                    <th scope="col">DNI</th>
                    <th scope="col">Nombre</th>
                    <th scope="col">Primer apellido</th>
                    <th scope="col">Segundo apellido</th>
                    <th class="col">Teléfono</th>
                    <th class="col">Correo</th>
                    <th class="col"></th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="user : ${adminUsersAssigned}">
                    <td><span th:text="${user.username}"></span></td>
                    <td><span th:text="${user.name}"></span></td>
                    <td><span th:text="${user.lastname}"></span></td>
                    <td><span th:text="${user.secondLastname}"></span></td>
                    <td><span th:text="${user.telefono}"></span></td>
                    <td><span th:text="${user.correo}"></span></td>
                    <td th:if="${usuario.username != user.username}" th:attr="onclick=|confirmDeleteAdmin('${user.username}')|"><i class="icofont-bin"></i></td>
                    <td th:if="${usuario.username == user.username}"></td>
                </tr>
                </tbody>
            </table>
        </section>

        <div class="row align-items-center justify-content-end">
            <div class="col-3 col-md-2">
                <a class="btn btn-info" href="#" th:href="@{/adminGimnasio/}">Volver</a>
            </div>
        </div>
    </div>

</body>

<footer th:replace="static/footer :: footer"></footer>
</html>