<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">

    <title>Barra menú</title>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">

    <link rel="stylesheet" href="#" th:href="@{/css/style.css}" />

    <script type="text/javascript" th:src="@{/js/utils.js}"></script>

    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.2/jquery-ui.min.js"></script>

    <script type="text/javascript">
    $(document).ready(function()
    {
        $("#sortable").sortable(
        {

            start: function(e, ui) {
                // creates a temporary attribute on the element with the old index
                $(this).attr('data-previndex', ui.item.index());
                //console.log("oldIndex: " + $(this).attr('data-previndex'));
            },
            update: function(e, ui) {
                // gets the new and old index then removes the temporary attribute
                var newIndex = ui.item.index();
                //console.log("newIndex: " + newIndex);
                var oldIndex = $(this).attr('data-previndex');
                var relativeUrl = "adminPais/pais/" + oldIndex + "/" + newIndex;
                var domain = getDomain(location.href);
                $(this).removeAttr('data-previndex');
                //console.log(location.href + " - " + domain + relativeUrl);
                location.href = domain + relativeUrl;
            }
        });
    }
    );

		function validarMenu1(){
			var campo = ['nombre'];
			restablecer();
			var validado = true;
			for(var i=0; i < campo.length; i++){
			    var nombreRol = document.getElementById(campo[i]);
				if(nombreRol.value==''){
					nombreRol.style.borderColor="red";
					validado = false;
				}
			}

			return validado;
		}

		function restablecer(){
			var campos = document.getElementsByClassName("form-control");
			for (var i = 0; i < campos.length; i++) {
				campos[i].style.borderColor="#ced4da";
			}
		}

		function confirmDeleteMenu1(){
            var menu1Elegido = document.getElementById('idMenu1').selectedOptions[0];
			if(confirm("¿Seguro que desea eliminar " + menu1Elegido.text + "?")){
                var relativeUrl = "adminMenu/menu1-remove/" + menu1Elegido.value;
                var domain = getDomain(location.href);
                location.href = domain + relativeUrl;
				return true;
			}
			return false;
		}

		function confirmDeleteMenu2(indexMenu1, indexMenu2){
            var menu2Elegido = document.getElementById('idMenu2' + indexMenu1 + indexMenu2).selectedOptions[0];
			if(confirm("¿Seguro que desea eliminar " + menu2Elegido.text + "?")){
                var relativeUrl = "adminMenu/menu2-remove/" + menu2Elegido.value;
                var domain = getDomain(location.href);
                location.href = domain + relativeUrl;
				return true;
			}
			return false;
		}
    </script>

</head>
<body>
    <div class="container">
        <h1>
            ¡Hola <span th:text="${usuario.name}"></span>!
            <a href="#" th:href="@{/usuario/formularioUsuario}"><span class="glyphicon glyphicon-user"></span></a>
        </h1>
        <nav class="navbar navbar-default" role="navigation">
            <form th:action="@{/logout}" method="POST">
                <button class="btn btn-primary pull-right" type="submit"><span class="glyphicon glyphicon-log-out" aria-hidden="true"></span> Salir</button>
            </form>
        </nav>

        <section>
            <div class="row">
                <div class="col-xs-2 mb-1">
                </div>

                <div class="col-xs-8 mb-10 colorGreen">
                    <h1>Opciones de la barra de menú</h1>
                </div>

                <div class="col-xs-2 mb-1">
                    <a class="btn btn-info pull-right" href="#" th:href="@{/principal/}">Volver</a>
                </div>
            </div>
        </section>

        <div th:if="${removeProblem != null}" class="alert alert-danger" role="alert"><span th:text="${removeProblem}"></span></div>

        <section  sec:authorize="hasRole('ROLE_ROOT')">

            <form action="#" th:action="@{/adminMenu/menu1-add}" th:object="${menu1Model}" method="post" onsubmit="return validarMenu1()">

              <div class="row mb-1">
                  <div class="col-xs-3 col-md-1">
                      <label for="nombre">Nombre:</label>
                  </div>
                  <div class="col-xs-9 col-md-2">
                      <input type="text" th:field="*{nombre}" id="nombre" class="form-control" placeholder="nombre" maxlength="30" />
                  </div>
                  <div class="col-xs-12 col-md-1">
                      <button class="btn btn-success" type="submit">Alta</button>
                  </div>
                  <div class="col-xs-5 col-md-1">
                  </div>
                  <div class="col-xs-5 col-md-3">
                      <select id="idMenu1" class="form-control form-control-lg">
                          <option th:each="unit : ${menu1List}" th:value="${unit.id}" th:text="${unit.nombre}"></option>
                      </select>
                  </div>
                  <div class="col-xs-2 col-md-1">
                      <button class="btn btn-danger" onclick="confirmDeleteMenu1()">Borrar</button>
                  </div>
              </div>
            </form>

            <div class="row">
              <div class="col-xs-3 col-md-4">
              </div>
              <div class="col-xs-5 col-md-3">
                  <ul id="sortable" class="s1 list-group mb-1">
                      <li th:each="unit : ${menu1List}" th:value="${unit.id}" th:text="${unit.nombre}" class="list-group-item move">
                      </li>
                  </ul>
              </div>
              <div class="col-xs-4 col-md-5">
              </div>
            </div>
        </section>



        <section sec:authorize="hasRole('ROLE_ROOT')" th:each="menu1, iStat : ${menu1List}">

            <h1>Submenú de <span th:value="${menu1.nombre}"></span></h1>

            <form action="#" th:action="@{/adminMenu/menu2-add}" th:object="${menu2Model}" method="post" th:attr="onsubmit='return validarMenu2(' + ${iStat.index} + ')'">

                <input type="hidden" name="idMenu1" th:value="${menu1.id}"/>

                <div class="row mb-1">
                    <div class="col-xs-3 col-md-1">
                        <label for="nombre">Nombre:</label>
                    </div>
                    <div class="col-xs-9 col-md-2">
                        <input type="text" th:field="*{nombre}" th:id="'nombre' + ${iStat.index}" class="form-control" placeholder="nombre" maxlength="30" />
                    </div>
                    <div class="col-xs-3 col-md-1">
                        <label th:attr="for='url' + ${iStat.index}">URL:</label>
                    </div>
                    <div class="col-xs-9 col-md-2">
                        <input type="text" th:field="*{url}" th:id="'url' + ${iStat.index}" class="form-control" placeholder="URL" maxlength="100" />
                    </div>
                    <div class="col-xs-3 col-md-1">
                        <label th:attr="for='aviso' + ${iStat.index}">Aviso:</label>
                    </div>
                    <div class="col-xs-9 col-md-2">
                        <input type="text" th:field="*{aviso}" th:id="'aviso' + ${iStat.index}" class="form-control" placeholder="Aviso" maxlength="30" />
                    </div>
                    <div class="col-xs-12 col-md-1">
                        <button class="btn btn-success" type="submit">Alta</button>
                    </div>
                    <div class="col-xs-5 col-md-1">
                    </div>
                    <div class="col-xs-5 col-md-3">
                        <select th:id="'idMenu2' + indexMenu1 + indexMenu2" class="form-control form-control-lg">
                            <option th:each="unit : ${menu1.menu2ModelList}" th:value="${unit.id}" th:text="${unit.nombre}"></option>
                        </select>
                    </div>
                    <div class="col-xs-2 col-md-1">
                        <button class="btn btn-danger" onclick="confirmDeleteMenu2()">Borrar</button>
                    </div>
                </div>
            </form>

            <div class="row">
                <div class="col-xs-3 col-md-4">
                </div>
                <div class="col-xs-5 col-md-3">
                    <ul id="sortable" class="s1 list-group mb-1">
                        <li th:each="unit : ${menu1List}" th:value="${unit.id}" th:text="${unit.nombre}" class="list-group-item move">
                        </li>
                    </ul>
                </div>
                <div class="col-xs-4 col-md-5">
                </div>
            </div>
        </section>

        <div class="row">
            <div class="col-xs-10">
            </div>
            <div class="col-xs-2">
                <a class="btn btn-info pull-right" href="#" th:href="@{/principal/}">Volver</a>
            </div>
        </div>
    </div>

</body>
</html>